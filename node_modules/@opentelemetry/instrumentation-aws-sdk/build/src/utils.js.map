{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":";;;AAAA;;;;;;;;;;;;;;GAcG;AACH,4CAAkE;AAClE,8EAI6C;AAC7C,mCAAyC;AAGlC,MAAM,8BAA8B,GAAG,CAC5C,GAAW,EACX,cAAsB,EACd,EAAE;IACV,MAAM,YAAY,GAAG,cAAc,CAAC,MAAM,CAAC;IAC3C,OAAO,GAAG,EAAE,KAAK,CAAC,CAAC,YAAY,CAAC,KAAK,cAAc;QACjD,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,GAAG,YAAY,CAAC;QACzC,CAAC,CAAC,GAAG,CAAC;AACV,CAAC,CAAC;AARW,QAAA,8BAA8B,kCAQzC;AAEK,MAAM,kBAAkB,GAAG,CAChC,WAAmB,EACnB,qBAA6B,EAC7B,YAAiC,EACjC,MAA0B,EACP,EAAE;IACrB,OAAO;QACL,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;QAC7C,WAAW,EAAE,IAAA,sCAA8B,EACzC,qBAAqB,EACrB,SAAS,CACV;QACD,YAAY;QACZ,MAAM;KACP,CAAC;AACJ,CAAC,CAAC;AAfW,QAAA,kBAAkB,sBAe7B;AAEK,MAAM,sCAAsC,GAAG,CACpD,iBAAoC,EACxB,EAAE;IACd,OAAO;QACL,CAAC,0CAAmB,CAAC,EAAE,SAAS;QAChC,CAAC,0CAAmB,CAAC,EAAE,iBAAiB,CAAC,WAAW;QACpD,CAAC,2CAAoB,CAAC,EAAE,iBAAiB,CAAC,WAAW;QACrD,CAAC,sBAAc,CAAC,YAAY,CAAC,EAAE,iBAAiB,CAAC,MAAM;KACxD,CAAC;AACJ,CAAC,CAAC;AATW,QAAA,sCAAsC,0CASjD;AAEK,MAAM,WAAW,GAAG,CACzB,MAAkB,EAClB,mBAA4B,EAC5B,WAAW,GAAG,CAAC,EACH,EAAE;IACd,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC;IAE7B,MAAM,CAAC,IAAI,GAAG,UACZ,WAAqC,EACrC,UAAoC;QAEpC,MAAM,cAAc,GAAG,aAAO,CAAC,IAAI,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;QACtE,MAAM,aAAa,GAAG,aAAO,CAAC,IAAI,CAAC,mBAAmB,EAAE,UAAU,CAAC,CAAC;QACpE,MAAM,cAAc,GAAG,QAAQ,CAAC,IAAI,CAIlC,IAAI,EAAE,cAAc,EAAE,aAAa,CAAC,CAAC;QACvC,OAAO,WAAW,GAAG,CAAC;YACpB,CAAC,CAAC,IAAA,mBAAW,EAAC,cAAc,EAAE,mBAAmB,EAAE,WAAW,GAAG,CAAC,CAAC;YACnE,CAAC,CAAC,cAAc,CAAC;IACrB,CAAC,CAAC;IACF,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AAvBW,QAAA,WAAW,eAuBtB","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Attributes, Context, context } from '@opentelemetry/api';\nimport {\n  SEMATTRS_RPC_METHOD,\n  SEMATTRS_RPC_SERVICE,\n  SEMATTRS_RPC_SYSTEM,\n} from '@opentelemetry/semantic-conventions';\nimport { AttributeNames } from './enums';\nimport { NormalizedRequest } from './types';\n\nexport const removeSuffixFromStringIfExists = (\n  str: string,\n  suffixToRemove: string\n): string => {\n  const suffixLength = suffixToRemove.length;\n  return str?.slice(-suffixLength) === suffixToRemove\n    ? str.slice(0, str.length - suffixLength)\n    : str;\n};\n\nexport const normalizeV3Request = (\n  serviceName: string,\n  commandNameWithSuffix: string,\n  commandInput: Record<string, any>,\n  region: string | undefined\n): NormalizedRequest => {\n  return {\n    serviceName: serviceName?.replace(/\\s+/g, ''),\n    commandName: removeSuffixFromStringIfExists(\n      commandNameWithSuffix,\n      'Command'\n    ),\n    commandInput,\n    region,\n  };\n};\n\nexport const extractAttributesFromNormalizedRequest = (\n  normalizedRequest: NormalizedRequest\n): Attributes => {\n  return {\n    [SEMATTRS_RPC_SYSTEM]: 'aws-api',\n    [SEMATTRS_RPC_METHOD]: normalizedRequest.commandName,\n    [SEMATTRS_RPC_SERVICE]: normalizedRequest.serviceName,\n    [AttributeNames.CLOUD_REGION]: normalizedRequest.region,\n  };\n};\n\nexport const bindPromise = <T = unknown>(\n  target: Promise<T>,\n  contextForCallbacks: Context,\n  rebindCount = 1\n): Promise<T> => {\n  const origThen = target.then;\n  type PromiseThenParameters = Parameters<Promise<T>['then']>;\n  target.then = function <TResult1 = T, TResult2 = never>(\n    onFulfilled: PromiseThenParameters[0],\n    onRejected: PromiseThenParameters[1]\n  ): Promise<TResult1 | TResult2> {\n    const newOnFulfilled = context.bind(contextForCallbacks, onFulfilled);\n    const newOnRejected = context.bind(contextForCallbacks, onRejected);\n    const patchedPromise = origThen.call<\n      Promise<T>,\n      any[],\n      Promise<TResult1 | TResult2>\n    >(this, newOnFulfilled, newOnRejected);\n    return rebindCount > 1\n      ? bindPromise(patchedPromise, contextForCallbacks, rebindCount - 1)\n      : patchedPromise;\n  };\n  return target;\n};\n"]}